<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>真牛英雄 | koa源码</title>
    <meta name="description" content="看啥看">
    
    
    <link rel="preload" href="/assets/css/36.styles.557faed4.css" as="style"><link rel="preload" href="/assets/js/app.8261995b.js" as="script"><link rel="preload" href="/assets/js/12.2dd19f95.js" as="script"><link rel="prefetch" href="/assets/js/0.2473a6f7.js"><link rel="prefetch" href="/assets/js/1.5ea79099.js"><link rel="prefetch" href="/assets/js/2.2b7f92b9.js"><link rel="prefetch" href="/assets/js/3.c35ac125.js"><link rel="prefetch" href="/assets/js/4.33745bd7.js"><link rel="prefetch" href="/assets/js/5.d9114106.js"><link rel="prefetch" href="/assets/js/6.9e328d79.js"><link rel="prefetch" href="/assets/js/7.5d3d1168.js"><link rel="prefetch" href="/assets/js/8.98d7c36f.js"><link rel="prefetch" href="/assets/js/9.575dad7c.js"><link rel="prefetch" href="/assets/js/10.052aa6a7.js"><link rel="prefetch" href="/assets/js/11.2bda47c3.js"><link rel="prefetch" href="/assets/js/13.ba47ffda.js"><link rel="prefetch" href="/assets/js/14.ef016eda.js"><link rel="prefetch" href="/assets/js/15.463b3f5a.js"><link rel="prefetch" href="/assets/js/16.92ba4283.js"><link rel="prefetch" href="/assets/js/17.0066a01b.js"><link rel="prefetch" href="/assets/js/18.faf31784.js"><link rel="prefetch" href="/assets/js/19.115165dc.js"><link rel="prefetch" href="/assets/js/20.8e4255e1.js"><link rel="prefetch" href="/assets/js/21.5bd4f746.js"><link rel="prefetch" href="/assets/js/22.7b518bea.js"><link rel="prefetch" href="/assets/js/23.48cf48d2.js"><link rel="prefetch" href="/assets/js/24.e80a0c2b.js"><link rel="prefetch" href="/assets/js/25.9620f9e6.js"><link rel="prefetch" href="/assets/js/26.c698f17b.js"><link rel="prefetch" href="/assets/js/27.f26b39ac.js"><link rel="prefetch" href="/assets/js/28.eed975fe.js"><link rel="prefetch" href="/assets/js/29.528313a0.js"><link rel="prefetch" href="/assets/js/30.b2c14d8a.js"><link rel="prefetch" href="/assets/js/31.0ded6227.js"><link rel="prefetch" href="/assets/js/32.d7376006.js"><link rel="prefetch" href="/assets/js/33.e735fef4.js"><link rel="prefetch" href="/assets/js/34.3ed1ff17.js"><link rel="prefetch" href="/assets/js/35.6d8f8c9b.js">
    <link rel="stylesheet" href="/assets/css/36.styles.557faed4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      真牛英雄
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blogs/coding/other/linux.html" class="nav-link">代码</a></div><div class="nav-item"><a href="/blogs/bodybuilding/tmf.html" class="nav-link">健身</a></div><div class="nav-item"><a href="/blogs/gameing/" class="nav-link">游戏</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blogs/coding/other/linux.html" class="nav-link">代码</a></div><div class="nav-item"><a href="/blogs/bodybuilding/tmf.html" class="nav-link">健身</a></div><div class="nav-item"><a href="/blogs/gameing/" class="nav-link">游戏</a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>区块链</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>其他</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Http</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>JavaScript学习</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>NodeJs学习</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/blogs/coding/node/koa.html" class="sidebar-link">koa入门</a></li><li><a href="/blogs/coding/node/koa-source.html" class="active sidebar-link">koa源码</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blogs/coding/node/koa-source.html#use-fn" class="sidebar-link">use(fn)</a></li><li class="sidebar-sub-header"><a href="/blogs/coding/node/koa-source.html#listen" class="sidebar-link">listen()</a></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>CSS学习</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Vue源码学习</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>React学习</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>docker学习</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Java学习</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Spring学习</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><p></p><div class="table-of-contents"><ul><li><a href="#use-fn">use(fn)</a></li><li><a href="#listen">listen()</a><ul><li><a href="#callback">callback()</a></li></ul></li></ul></div><p></p><h1 id="koa"><a href="#koa" aria-hidden="true" class="header-anchor">#</a> koa</h1><p>从koa的package.json找到,我们require进程序的是
<code>@/lib/application</code>文件export出来的内容,
打开对应的文件 第一句代码便是</p><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token keyword">extends</span> <span class="token class-name">Emitter</span>
</code></pre><p>由此可知<code>Application</code>类继承了<code>Eimtter</code>也就是<code>events</code>库</p><p><code>Application</code>一共就200+行代码
其中包括</p><ul><li>constructor</li><li>listen()</li><li>toJSON()
<ul><li>返回实例中抽取的<code>subdomainOffset</code>,<code>proxy</code>,<code>proxy</code>属性组成的JSON对象</li></ul></li><li>inspect()
<ul><li>调用了toJSON()</li></ul></li><li><strong>use(fn)</strong></li></ul><p>另外包括了几个私有方法</p><ul><li>callback()</li><li>handleRequest()</li><li>createContext()</li><li>onerror()</li></ul><p><code>callback</code>,<code>handleRequest</code>,<code>createContext</code>,<code>onerror</code>等是私有方法,具体功能在介绍相关功能时展开</p><h2 id="use-fn"><a href="#use-fn" aria-hidden="true" class="header-anchor">#</a> use(fn)</h2><p>koa2 基于ES6,使用了很多ES6的新特性,
其中最重要的就是<code>generator</code>,<code>yield</code>等特性</p><pre class="language-javascript"><code><span class="token comment">// 控制参数类型</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> fn <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'middleware must be a function!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 判断是否是Generator生成的方法</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isGeneratorFunction</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将generator生成的函数转化成 调用co函数的函数</span>
    fn <span class="token operator">=</span> <span class="token function">convert</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 将中间件函数放入中间件数组</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>middleware<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 返回实例 =====&gt; 所以支持链式调用</span>
<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
</code></pre><p>::: tips co函数????
在use方法中的convert函数中,
使用co库将用户传入的fn包装成了一个thunk函数
:::</p><h2 id="listen"><a href="#listen" aria-hidden="true" class="header-anchor">#</a> listen()</h2><pre class="language-javascript"><code><span class="token comment">// callback方法稍后解释</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>从源码知道<code>listen</code>方法其实就是调用<code>http.createServer</code>,然后监听指定端口并创建了一个<code>web服务</code></p><h3 id="callback"><a href="#callback" aria-hidden="true" class="header-anchor">#</a> callback()</h3><pre class="language-javascript"><code>  <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fn <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>middleware<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">listenerCount</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onerror<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handleRequest</span> <span class="token operator">=</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 通过createContext方法 加工node原生的req和res生成koa的context对象</span>
      <span class="token keyword">const</span> ctx <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 然后交由koa实例的handleRequest处理</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleRequest</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> handleRequest<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><p><code>fn</code>方法经由<code>compose</code>方法加工后传入handleRequest</p><p>callback方法返回了一个入参为<code>req</code>,<code>res</code>的<code>handlerRequest</code>函数
来作为<code>http.createServer</code>的参数</p><h4 id="compose"><a href="#compose" aria-hidden="true" class="header-anchor">#</a> compose</h4><p><strong>为什么koa中next可以实现中间件的链式传递?</strong></p><pre class="language-javascript"><code> <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// last called middleware #</span>
    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">return</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">function</span> <span class="token function">dispatch</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果多次调用next,在第二次调用是,i已经在上一次next中被设置为(i+n)</span>
      <span class="token comment">// index必然会&gt;i</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> index<span class="token punctuation">)</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'next() called multiple times'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token comment">// index记录调用栈的深度</span>
      index <span class="token operator">=</span> i
      <span class="token keyword">let</span> fn <span class="token operator">=</span> middleware<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> middleware<span class="token punctuation">.</span>length<span class="token punctuation">)</span> fn <span class="token operator">=</span> next
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fn<span class="token punctuation">)</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token comment">// dispatch最终返回一个promise,</span>
          <span class="token comment">// app.use(fnRaw)</span>
          <span class="token comment">// fnRaw = fn(ctx,next) = fn(next,dispatch(i+1)) </span>
        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> dispatch<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre><p>::: tips compose
将<code>dispatch(i)</code>方法做为<code>next</code>方法,连同context传入下一个<code>fn</code>也就是中间件函数,
所以当注册中间的时候,next方法可以进入到下一个中间件函数中
:::</p><h4 id="handlerequest"><a href="#handlerequest" aria-hidden="true" class="header-anchor">#</a> handleRequest</h4><p><code>handleRequest</code>方法接受两个参数,一个是上下文<code>ctx</code> ,一个是中间件函数<code>fnMiddleware</code></p><pre class="language-javascript"><code>  <span class="token function">handleRequest</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> fnMiddleware<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> ctx<span class="token punctuation">.</span>res<span class="token punctuation">;</span>
    <span class="token comment">// 默认status</span>
    res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">onerror</span> <span class="token operator">=</span> err <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">onerror</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handleResponse</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">respond</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 还没看明白这个方法做什么.....</span>
    <span class="token function">onFinished</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> onerror<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">fnMiddleware</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>handleResponse<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>onerror<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><p><code>respond</code>方法主要处理的是将<code>ctx.body</code>的内容通过node原生的response来返回给请求端</p><p>在上面的return方法中,只把ctx一个参数塞入<code>fnMiddleware</code>但是我们在实际运用中,还有一个<code>next</code>方法?</p><p>所以整个listen方法大概就是</p><pre class="language-javascript"><code>http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span>fn<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token function">respond</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>onerror<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><h4 id="createcontext"><a href="#createcontext" aria-hidden="true" class="header-anchor">#</a> createContext</h4><pre class="language-javascript"><code><span class="token function">createContext</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> context <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> request <span class="token operator">=</span> context<span class="token punctuation">.</span>request <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> context<span class="token punctuation">.</span>response <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span>app <span class="token operator">=</span> request<span class="token punctuation">.</span>app <span class="token operator">=</span> response<span class="token punctuation">.</span>app <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span>req <span class="token operator">=</span> request<span class="token punctuation">.</span>req <span class="token operator">=</span> response<span class="token punctuation">.</span>req <span class="token operator">=</span> req<span class="token punctuation">;</span>
    context<span class="token punctuation">.</span>res <span class="token operator">=</span> request<span class="token punctuation">.</span>res <span class="token operator">=</span> response<span class="token punctuation">.</span>res <span class="token operator">=</span> res<span class="token punctuation">;</span>
    request<span class="token punctuation">.</span>ctx <span class="token operator">=</span> response<span class="token punctuation">.</span>ctx <span class="token operator">=</span> context<span class="token punctuation">;</span>
    request<span class="token punctuation">.</span>response <span class="token operator">=</span> response<span class="token punctuation">;</span>
    response<span class="token punctuation">.</span>request <span class="token operator">=</span> request<span class="token punctuation">;</span>
    context<span class="token punctuation">.</span>originalUrl <span class="token operator">=</span> request<span class="token punctuation">.</span>originalUrl <span class="token operator">=</span> req<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
    context<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> context<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><code>createContext</code>方法中对context的<code>req</code>与<code>res</code>对node原生的<code>request</code>和<code>response</code>做了一层引用</p></div><!----><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/blogs/coding/node/koa.html" class="prev">
          koa入门
        </a></span><span class="next"><a href="/blogs/coding/css/">
          样式
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/12.2dd19f95.js" defer></script><script src="/assets/js/app.8261995b.js" defer></script>
  </body>
</html>
